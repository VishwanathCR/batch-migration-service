To implement PGP encryption for a file generated by `FlatFileItemWriter` using Java 21, Spring Batch 5.2, and Gradle, follow these steps:

### 1. **Add Dependencies** (`build.gradle.kts`)
```kotlin
dependencies {
    // Spring Batch
    implementation("org.springframework.boot:spring-boot-starter-batch")
    
    // Bouncy Castle for PGP
    implementation("org.bouncycastle:bcpg-jdk18on:1.77")
    
    // Other Spring dependencies
    runtimeOnly("com.h2database:h2") // Example database
}
```

### 2. **PGP Encryption Utility Class**
```java
import org.bouncycastle.jce.provider.BouncyCastleProvider;
import org.bouncycastle.openpgp.*;
import org.bouncycastle.openpgp.jcajce.JcaPGPObjectFactory;
import org.bouncycastle.openpgp.operator.jcajce.*;
import java.io.*;
import java.security.SecureRandom;
import java.security.Security;
import java.util.Iterator;

public class PGPEncryptor {

    static {
        Security.addProvider(new BouncyCastleProvider());
    }

    public static void encryptFile(File inputFile, File outputFile, File publicKeyFile) throws IOException, PGPException {
        try (InputStream pubKeyStream = new FileInputStream(publicKeyFile);
             OutputStream encryptedOut = new FileOutputStream(outputFile);
             InputStream inputData = new FileInputStream(inputFile)) {

            PGPPublicKey publicKey = readPublicKey(pubKeyStream);
            encryptFile(inputData, encryptedOut, publicKey);
        }
    }

    private static PGPPublicKey readPublicKey(InputStream input) throws IOException, PGPException {
        InputStream decoderStream = PGPUtil.getDecoderStream(input);
        PGPPublicKeyRingCollection keyRings = new PGPPublicKeyRingCollection(decoderStream, new JcaKeyFingerprintCalculator());

        Iterator<PGPPublicKeyRing> keyRingIter = keyRings.getKeyRings();
        while (keyRingIter.hasNext()) {
            PGPPublicKeyRing keyRing = keyRingIter.next();
            Iterator<PGPPublicKey> keyIter = keyRing.getPublicKeys();
            while (keyIter.hasNext()) {
                PGPPublicKey key = keyIter.next();
                if (key.isEncryptionKey()) {
                    return key;
                }
            }
        }
        throw new IllegalArgumentException("No encryption key found in public key file.");
    }

    private static void encryptFile(InputStream input, OutputStream output, PGPPublicKey publicKey) throws IOException, PGPException {
        output = new ArmoredOutputStream(output); // ASCII-armored output

        PGPEncryptedDataGenerator encryptor = new PGPEncryptedDataGenerator(
            new JcePGPDataEncryptorBuilder(PGPEncryptedData.AES_256)
                .setWithIntegrityPacket(true)
                .setSecureRandom(new SecureRandom())
                .setProvider(BouncyCastleProvider.PROVIDER_NAME)
        );
        encryptor.addMethod(new JcePublicKeyKeyEncryptionMethodGenerator(publicKey));

        try (OutputStream cipherStream = encryptor.open(output, new byte[4096]);
             OutputStream literalStream = new PGPLiteralDataGenerator().open(
                 cipherStream,
                 PGPLiteralData.BINARY,
                 "file",
                 input.available(),
                 new Date()
             )) {
            byte[] buffer = new byte[4096];
            int bytesRead;
            while ((bytesRead = input.read(buffer)) >= 0) {
                literalStream.write(buffer, 0, bytesRead);
            }
        }
        output.close(); // Ensure ArmoredOutputStream writes footer
    }
}
```

### 3. **Tasklet for Encryption**
```java
import org.springframework.batch.core.StepContribution;
import org.springframework.batch.core.scope.context.ChunkContext;
import org.springframework.batch.core.step.tasklet.Tasklet;
import org.springframework.batch.repeat.RepeatStatus;
import org.springframework.core.io.Resource;
import java.io.File;

public class PGPEncryptionTasklet implements Tasklet {

    private Resource inputResource;
    private Resource outputResource;
    private Resource publicKeyResource;

    // Setters omitted for brevity

    @Override
    public RepeatStatus execute(StepContribution contribution, ChunkContext chunkContext) throws Exception {
        File inputFile = inputResource.getFile();
        File outputFile = outputResource.getFile();
        File publicKeyFile = publicKeyResource.getFile();

        PGPEncryptor.encryptFile(inputFile, outputFile, publicKeyFile);
        return RepeatStatus.FINISHED;
    }
}
```

### 4. **Spring Batch Job Configuration**
```java
import org.springframework.batch.core.Job;
import org.springframework.batch.core.Step;
import org.springframework.batch.core.job.builder.JobBuilder;
import org.springframework.batch.core.repository.JobRepository;
import org.springframework.batch.core.step.builder.StepBuilder;
import org.springframework.batch.item.file.FlatFileItemWriter;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import org.springframework.core.io.FileSystemResource;
import org.springframework.transaction.PlatformTransactionManager;

@Configuration
public class BatchConfig {

    @Bean
    public Job job(JobRepository jobRepository, Step generateFileStep, Step encryptStep) {
        return new JobBuilder("dataExportJob", jobRepository)
            .start(generateFileStep)
            .next(encryptStep)
            .build();
    }

    @Bean
    public Step generateFileStep(JobRepository jobRepository, PlatformTransactionManager txManager,
                                 FlatFileItemWriter<MyData> writer) {
        return new StepBuilder("generateFileStep", jobRepository)
            .<MyData, MyData>chunk(100, txManager)
            .reader(dataReader())
            .writer(writer)
            .build();
    }

    @Bean
    public Step encryptStep(JobRepository jobRepository, PlatformTransactionManager txManager,
                            PGPEncryptionTasklet encryptionTasklet) {
        return new StepBuilder("encryptStep", jobRepository)
            .tasklet(encryptionTasklet, txManager)
            .build();
    }

    @Bean
    public FlatFileItemWriter<MyData> fileWriter() {
        return new FlatFileItemWriterBuilder<MyData>()
            .name("fileWriter")
            .resource(new FileSystemResource("output/unencrypted.txt"))
            .delimited().delimiter(",")
            .names("field1", "field2")
            .build();
    }

    @Bean
    public PGPEncryptionTasklet encryptionTasklet() {
        PGPEncryptionTasklet tasklet = new PGPEncryptionTasklet();
        tasklet.setInputResource(new FileSystemResource("output/unencrypted.txt"));
        tasklet.setOutputResource(new FileSystemResource("output/encrypted.pgp"));
        tasklet.setPublicKeyResource(new FileSystemResource("keys/public.asc"));
        return tasklet;
    }
}
```

### 5. **How It Works**
1. **File Generation**:  
   The `generateFileStep` uses a `FlatFileItemWriter` to create `unencrypted.txt`.

2. **Encryption Tasklet**:  
   The `encryptStep` runs after file generation:
   - Reads the generated file (`unencrypted.txt`)
   - Encrypts it using the public key (`public.asc`)
   - Writes the encrypted output to `encrypted.pgp`

3. **PGP Operations**:
   - **Key Loading**: Reads the ASCII-armored public key.
   - **Encryption**: Uses AES-256 encryption with integrity checks.
   - **Output**: Generates an ASCII-armored (`.pgp`) file.

### 6. **Generate a PGP Key Pair**
```bash
gpg --batch --generate-key <<EOF
Key-Type: RSA
Key-Length: 4096
Subkey-Type: RSA
Subkey-Length: 4096
Name-Real: Your Name
Name-Email: your@email.com
Expire-Date: 0
%commit
EOF

gpg --export -a "Your Name" > public.asc
```

### Key Points
- **Security**: Uses Bouncy Castle's robust PGP implementation.
- **Resource Handling**: Spring manages file paths via `Resource` abstractions.
- **Modularity**: Separation of concerns (file generation vs. encryption).
- **Error Handling**: Add try-catch blocks in `PGPEncryptor` for production resilience.

This setup ensures your Spring Batch job generates a plaintext file and automatically encrypts it with PGP using industry-standard practices.
